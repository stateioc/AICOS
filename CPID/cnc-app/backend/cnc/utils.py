import re
from collections import namedtuple
from typing import Tuple

ComputingID = namedtuple(
    "ComputingID",
    [
        "city",
        "industry",
        "organization",
        "resource_type",
        "region",
        "availability_zone",
        "service_type",
        "computer_total",
        "storage_total",
        "network_total",
    ],
)


def parse_computing_id(computing_id: str) -> ComputingID:
    # 解析用户城市
    city = _get_name_by_id("city", computing_id[:4])

    # 解析算力行业
    industry = _get_name_by_id("industry", computing_id[4:6])

    # 解析算力厂商
    if not computing_id[6:11].isdigit():
        raise ValueError(f"invalid computing_id: {computing_id}")

    organization = int(computing_id[6:11])

    # 解析算力资源类型
    resource_type = _get_name_by_id("resource_type", computing_id[11:14])

    # 解析算力所在城市
    region = _get_name_by_id("city", computing_id[14:18])

    # 解析算力可用区
    availability_zone = _get_name_by_id("availability_zone", computing_id[18:21])

    # 解析服务类型
    service_type = _get_name_by_id("service_type", computing_id[21:27])

    return ComputingID(
        city,
        industry,
        organization,
        resource_type,
        region,
        availability_zone,
        service_type,
        *_parse_computer_storage_network(computing_id[27:]),
    )


def _get_name_by_id(_type: str, _id: str) -> str:
    dictionary = globals()[f"{_type}_dict"]

    if _id not in dictionary:
        raise ValueError(f"{_type} id {_id} not found")

    return dictionary.get(_id)


def _parse_computer_storage_network(
    _id: str,
) -> Tuple[str, str, str, str]:
    r = re.match(r"^F(\d+)S(\d+)N(\d+)P(\d+)$", _id)
    if not r:
        raise ValueError(
            f"{_id} is not a valid computing computer storage network power_consumption"
        )
    return (int(r.group(1)), int(r.group(2)), int(r.group(3)))


city_dict = {
    "1101": "北京",
    "1201": "天津",
    "1301": "石家庄",
    "1302": "唐山",
    "1303": "秦皇岛",
    "1304": "邯郸",
    "1305": "邢台",
    "1306": "保定",
    "1307": "张家口",
    "1308": "承德",
    "1309": "沧州",
    "1310": "廊坊",
    "1311": "衡水",
    "1401": "太原",
    "1402": "大同",
    "1403": "阳泉",
    "1404": "长治",
    "1405": "晋城",
    "1406": "朔州",
    "1407": "晋中",
    "1408": "运城",
    "1409": "忻州",
    "1410": "临汾",
    "1411": "吕梁",
    "1501": "呼和浩特",
    "1502": "包头",
    "1503": "乌海",
    "1504": "赤峰",
    "1505": "通辽",
    "1506": "鄂尔多斯",
    "1507": "呼伦贝尔",
    "1508": "巴彦淖尔",
    "1509": "乌兰察布",
    "1522": "兴安盟",
    "1525": "锡林郭勒",
    "1529": "阿拉善盟",
    "2101": "沈阳",
    "2102": "大连",
    "2103": "鞍山",
    "2104": "抚顺",
    "2105": "本溪",
    "2106": "丹东",
    "2107": "锦州",
    "2108": "营口",
    "2109": "阜新",
    "2110": "辽阳",
    "2111": "盘锦",
    "2112": "铁岭",
    "2113": "朝阳",
    "2114": "葫芦岛",
    "2201": "长春",
    "2202": "吉林",
    "2203": "四平",
    "2204": "辽源",
    "2205": "通化",
    "2206": "白山",
    "2207": "松原",
    "2208": "白城",
    "2224": "延边",
    "2301": "哈尔滨",
    "2302": "齐齐哈尔",
    "2303": "鸡西",
    "2304": "鹤岗",
    "2305": "双鸭山",
    "2306": "大庆",
    "2307": "伊春",
    "2308": "佳木斯",
    "2309": "七台河",
    "2310": "牡丹江",
    "2311": "黑河",
    "2312": "绥化",
    "2327": "大兴安岭",
    "3101": "上海",
    "3201": "南京",
    "3202": "无锡",
    "3203": "徐州",
    "3204": "常州",
    "3205": "苏州",
    "3206": "南通",
    "3207": "连云港",
    "3208": "淮安",
    "3209": "盐城",
    "3210": "扬州",
    "3211": "镇江",
    "3212": "泰州",
    "3213": "宿迁",
    "3301": "杭州",
    "3302": "宁波",
    "3303": "温州",
    "3304": "嘉兴",
    "3305": "湖州",
    "3306": "绍兴",
    "3307": "金华",
    "3308": "衢州",
    "3309": "舟山",
    "3310": "台州",
    "3311": "丽水",
    "3401": "合肥",
    "3402": "芜湖",
    "3403": "蚌埠",
    "3404": "淮南",
    "3405": "马鞍山",
    "3406": "淮北",
    "3407": "铜陵",
    "3408": "安庆",
    "3410": "黄山",
    "3411": "滁州",
    "3412": "阜阳",
    "3413": "宿州",
    "3415": "六安",
    "3416": "豪州",
    "3417": "池州",
    "3418": "宣城",
    "3501": "福州",
    "3502": "厦门",
    "3503": "莆田",
    "3504": "三明",
    "3505": "泉州",
    "3506": "漳州",
    "3507": "南平",
    "3508": "龙岩",
    "3509": "宁德",
    "3601": "南昌",
    "3602": "景德镇",
    "3603": "萍乡",
    "3604": "九江",
    "3605": "新余",
    "3606": "鹰潭",
    "3607": "赣州",
    "3608": "吉安",
    "3609": "宜春",
    "3610": "抚州",
    "3611": "上饶",
    "3701": "济南",
    "3702": "青岛",
    "3703": "淄博",
    "3704": "枣庄",
    "3705": "东营",
    "3706": "烟台",
    "3707": "潍坊",
    "3708": "济宁",
    "3709": "泰安",
    "3710": "威海",
    "3711": "日照",
    "3713": "临沂",
    "3714": "德州",
    "3715": "聊城",
    "3716": "滨州",
    "3717": "菏泽",
    "4101": "郑州",
    "4102": "开封",
    "4103": "洛阳",
    "4104": "平顶山",
    "4105": "安阳",
    "4106": "鹤壁",
    "4107": "新乡",
    "4108": "焦作",
    "4109": "濮阳",
    "4110": "许昌",
    "4111": "漯河",
    "4112": "三门峡",
    "4113": "南阳",
    "4114": "商丘",
    "4115": "信阳",
    "4116": "周口",
    "4117": "驻马店",
    "4201": "武汉",
    "4202": "黄石",
    "4203": "十堰",
    "4205": "宜昌",
    "4206": "襄阳",
    "4207": "鄂州",
    "4208": "荆门",
    "4209": "孝感",
    "4210": "荆州",
    "4211": "黄冈",
    "4212": "咸宁",
    "4213": "随州",
    "4228": "恩施",
    "4301": "长沙",
    "4302": "株洲",
    "4303": "湘潭",
    "4304": "衡阳",
    "4305": "邵阳",
    "4306": "岳阳",
    "4307": "常德",
    "4308": "张家界",
    "4309": "益阳",
    "4310": "郴州",
    "4311": "永州",
    "4312": "怀化",
    "4313": "娄底",
    "4331": "湘西",
    "4401": "广州",
    "4402": "韶关",
    "4403": "深圳",
    "4404": "珠海",
    "4405": "汕头",
    "4406": "佛山",
    "4407": "江门",
    "4408": "湛江",
    "4409": "茂名",
    "4412": "肇庆",
    "4413": "惠州",
    "4414": "梅州",
    "4415": "汕尾",
    "4416": "河源",
    "4417": "阳江",
    "4418": "清远",
    "4419": "东莞",
    "4420": "中山",
    "4451": "潮州",
    "4452": "揭阳",
    "4453": "云浮",
    "4501": "南宁",
    "4502": "柳州",
    "4503": "桂林",
    "4504": "梧州",
    "4505": "北海",
    "4506": "防城港",
    "4507": "钦州",
    "4508": "贵港",
    "4509": "玉林",
    "4510": "白色",
    "4511": "贺州",
    "4512": "河池",
    "4513": "来宾",
    "4514": "崇左",
    "4601": "海口",
    "4602": "三亚",
    "4603": "三沙",
    "4604": "儋州",
    "5001": "重庆市区",
    "5002": "重庆县",
    "5101": "成都",
    "5103": "自贡",
    "5104": "攀枝花",
    "5105": "泸州",
    "5106": "德阳",
    "5107": "绵阳",
    "5108": "广元",
    "5109": "遂宁",
    "5110": "内江",
    "5111": "乐山",
    "5113": "南充",
    "5114": "眉山",
    "5115": "宜宾",
    "5116": "广安",
    "5117": "达州",
    "5118": "雅安",
    "5119": "巴中",
    "5120": "资阳",
    "5132": "阿坝",
    "5133": "甘孜",
    "5134": "凉山",
    "5201": "贵阳",
    "5202": "六盘水",
    "5203": "遵义",
    "5204": "安顺",
    "5205": "毕节",
    "5206": "铜仁",
    "5233": "黔西南",
    "5226": "黔东南",
    "5227": "黔南",
    "5301": "昆明",
    "5303": "曲靖",
    "5304": "玉溪",
    "5305": "保山",
    "5306": "昭通",
    "5307": "丽江",
    "5308": "普洱",
    "5309": "临沧",
    "5323": "楚雄",
    "5325": "红河",
    "5326": "文山",
    "5328": "西双版纳",
    "5329": "大理",
    "5331": "德宏",
    "5333": "怒江",
    "5334": "迪庆",
    "5401": "拉萨",
    "5402": "日喀则",
    "5403": "昌都",
    "5404": "林芝",
    "5405": "山南",
    "5406": "那曲",
    "5425": "阿里",
    "6101": "西安",
    "6102": "铜川",
    "6103": "宝鸡",
    "6104": "咸阳",
    "6105": "渭南",
    "6106": "延安",
    "6107": "汉中",
    "6108": "榆林",
    "6109": "安康",
    "6110": "南洛",
    "6201": "兰州",
    "6202": "嘉峪关",
    "6203": "金昌",
    "6204": "白银",
    "6205": "天水",
    "6206": "武威",
    "6207": "张掖",
    "6208": "平凉",
    "6209": "酒泉",
    "6210": "庆阳",
    "6211": "定西",
    "6212": "陇南",
    "6229": "临夏",
    "6230": "甘南",
    "6301": "西宁",
    "6302": "海东",
    "6322": "海北",
    "6323": "黄南",
    "6325": "海南",
    "6326": "果洛",
    "6327": "玉树",
    "6328": "海西",
    "6401": "银川",
    "6402": "石嘴山",
    "6403": "吴忠",
    "6404": "固原",
    "6405": "中卫",
    "6501": "乌鲁木齐",
    "6502": "克拉玛依",
    "6504": "吐鲁番",
    "6505": "哈密",
    "6523": "昌吉",
    "6527": "博尔塔拉",
    "6528": "巴音郭楞",
    "6529": "阿克苏",
    "6530": "克孜勒苏",
    "6531": "喀什",
    "6532": "和田",
    "6540": "伊犁",
    "6542": "塔城",
    "6543": "阿勒泰",
    "6544": "其他",
}

industry_dict = {
    "in": "保险业",
    "mn": "采矿",
    "en": "能源",
    "fr": "餐饮",
    "ho": "宾馆",
    "tc": "电讯业",
    "rs": "房地产",
    "sv": "服务",
    "cl": "服装业",
    "no": "公益组织",
    "ad": "广告业",
    "av": "航空航天",
    "ch": "化学",
    "hp": "健康、保健",
    "bd": "建筑业",
    "ed": "教育、培训",
    "cp": "计算机",
    "mm": "金属冶炼",
    "sf": "警察、消防",
    "ac": "会计",
    "bt": "美容",
    "mp": "媒体、出版",
    "wp": "木材、造纸",
    "rt": "零售、批发",
    "ag": "农业",
    "tr": "运输业",
    "lw": "司法、律师",
    "dr": "司机",
    "sp": "体育运动",
    "re": "学术研究",
    "ar": "演艺、艺术、设计",
    "bf": "银行、金融",
    "it": "因特网",
    "md": "音乐舞蹈",
    "sl": "邮政快递",
    "go": "政府机关",
    "mg": "机械制造",
    "cn": "咨询",
    "ot": "其他",
}

organization_dict = {
    "20001": "天翼云科技有限公司",
    "20002": "中科院计算机网络信息中心",
    "20003": "中国联通",
    "20004": "中国移动通信集团有限公司",
    "20005": "阿里云计算技术有限公司",
    "20006": "腾讯云计算（北京）有限公司",
    "20007": "华为云计算技术有限公司",
    "20008": "优刻得科技股份有限公司",
    "20009": "北京金山云网络技术有限公司",
    "20010": "中国广电",
    "20011": "联想",
    "20012": "浪潮软件科技有限公司",
    "20013": "中科曙光",
    "20014": "恒泰艾普",
    "20015": "南威软件",
    "20016": "中际旭创",
    "20017": "平安银行股份有限公司",
    "20018": "科大讯飞",
    "20019": "华大基因",
    "20020": "青云",
    "20021": "北京百度网讯科技有限公司",
    "20022": "中科创达",
    "20023": "字节跳动",
    "20024": "中国电子系统技术有限公司",
    "20025": "南方电网深圳数字研究院",
    "20026": "中国鸿信信息科技有限公司",
    "20027": "广州广电运通金融电子股份有限公司",
    "20028": "网络通信与安全紫金山实验室",
    "20029": "中移（苏州）软件技术有限公司",
    "20030": "芯启源（南京）半导体科技有限公司",
    "20031": "京东科技信息技术有限公司",
    "20032": "新智云数据服务有限公司",
    "20033": "北京火山引擎科技有限公司",
    "20034": "人民数据管理（北京）有限公司",
    "20035": "中移动信息技术有限公司",
    "20036": "上海有孚网络股份有限公司",
    "20037": "深信服科技股份有限公司",
    "20038": "深圳市众云数据有限公司",
    "20039": "用友网络科技股份有限公司",
    "20040": "北京顶象技术有限公司",
    "20041": "浪潮云信息技术股份有限公司",
    "20042": "北京升鑫网络科技有限公司",
    "20043": "中国电信股份有限公司",
    "20044": "奇安信网络信息技术（北京）股份有限公司",
    "20045": "北京神州绿盟科技有限公司",
    "20046": "中兴通讯股份有限公司",
    "20047": "大连易衡科技有限公司",
    "20048": "中电云数智科技有限公司",
    "20049": "宁夏西云数据科技有限公司",
    "20050": "中国联合网络通信有限公司软件研究院",
    "20051": "广东润联信息技术有限公司",
    "20052": "平安壹账通云科技（深圳）有限公司",
    "20053": "北京神州云合数据科技发展有限公司",
    "20054": "云流科技（广州）有限公司",
    "20055": "华润数字科技有限公司",
    "20056": "云领信息技术（天津）有限公司",
    "20057": "北京飞书科技有限公司",
    "20058": "搜狗",
    "20999": "其他",
}

resource_type_dict = {"401": "超算", "402": "智算", "403": "通用计算"}

availability_zone_dict = {
    "501": "可用区一",
    "502": "可用去二",
    "503": "可用区三",
    "504": "可用区四",
    "505": "可用区五",
    "510": "可用区",
}

service_type_dict = {
    "601001": "云服务器",
    "601002": "轻量应用服务器",
    "601003": "裸金属云服务器",
    "601004": "GPU 云服务器",
    "601005": "FPGA 云服务器",
    "601006": "专用宿主机",
    "601007": "弹性伸缩",
    "601008": "高性能计算集群",
    "601009": "超级计算集群",
    "601010": "批量计算",
    "601011": "操作系统与工具",
    "601012": "计算加速套件",
    "601013": "分布式云",
    "601014": "本地专用集群",
    "601015": "专属计算集群",
    "601016": "边缘计算集群",
    "602001": "容器服务",
    "602002": "Serverless 容器服务",
    "602003": "容器镜像服务",
    "602004": "Serverless",
    "602005": "云函数",
    "602006": "Serverless 应用中心",
    "602007": "Serverless HTTP 服务",
    "602008": "Serverless SSR",
    "602009": "云原生分布式云中心",
    "602010": "边缘容器服务",
    "602011": "云原生可观测",
    "602012": "应用性能监控",
    "602013": "前端性能监控",
    "602014": "云拨测",
    "602015": "Prometheus 监控服务",
    "602016": "Grafana 服务",
    "602017": "混沌演练平台",
    "602018": "消息队列",
    "602019": "消息队列 RocketMQ 版",
    "602020": "消息队列 Kafka 版",
    "602021": "消息队列 RabbitMQ 版",
    "602022": "数据接入",
    "602023": "事件总线",
    "602024": "微服务引擎",
    "602025": "API 网关",
    "602026": "云原生 API 网关",
    "602027": "服务网格",
    "602028": "注册配置中心",
    "603001": "对象存储",
    "603002": "云硬盘",
    "603003": "文件存储 NAS",
    "603004": "文件存储 CPFS",
    "603005": "文件存储 HDFS",
    "603006": "数据加速器",
    "603007": "数据协作平台",
    "603008": "存储网关",
    "603009": "存储一体机",
    "603010": "备份一体机",
    "603011": "迁移服务平台",
    "603012": "云数据迁移",
    "604001": "关系型数据库",
    "604002": "云原生数据库",
    "604003": "云数据库 MySQL",
    "604004": "云数据库 MariaDB",
    "604005": "云数据库 SQL Server",
    "604006": "云数据库 PostgreSQL",
    "604007": "数据库软硬一体",
    "604008": "数据库一体机",
    "604009": "云数据库独享集群",
    "604010": "NoSQL 数据库",
    "604011": "云数据库 Redis",
    "604012": "云数据库 MongoDB",
    "604013": "云数据库 Memcached",
    "604014": "时序数据库",
    "604015": "游戏数据库",
    "604016": "图数据库 KonisGraph",
    "604017": "数据库分布式云",
    "604018": "数据库 SaaS 服务",
    "604019": "数据传输服务",
    "604020": "数据库专家服务",
    "604021": "数据库备份服务",
    "604022": "数据库管理",
    "605001": "负载均衡",
    "605002": "私有网络",
    "605003": "弹性网卡",
    "605004": "NAT 网关",
    "605005": "网络流日志",
    "605006": "公网加速",
    "605007": "共享带宽包",
    "605008": "共享流量包",
    "605009": "弹性公网 IPv6",
    "605010": "弹性公网 IP",
    "605011": "私有连接",
    "605012": "对等连接",
    "605013": "专线接入",
    "605014": "云接入网",
    "605015": "VPN 连接",
    "605016": "内容分发网络 CDN",
    "605017": "全站加速网络",
    "605018": "安全加速 SCDN",
    "606001": "云通信",
    "606002": "即时通信 IM",
    "606003": "云呼叫中心",
    "606004": "短信",
    "606005": "语音消息",
    "606006": "号码认证",
    "606007": "移动网络加速",
    "606008": "远程实时操控",
    "606009": "邮件推送",
    "606010": "边缘计算机器",
    "606011": "实时音视频",
    "606012": "云直播",
    "606013": "标准直播",
    "606014": "慢直播",
    "606015": "快直播",
    "606016": "虚拟直播",
    "606017": "云导播台",
    "606018": "云点播",
    "606019": "媒体智能管理",
    "606020": "媒体加工处理",
    "606021": "媒体 AI 处理",
    "606022": "媒体加密与版权保护",
    "606023": "媒体分发播放",
    "606024": "直点播互转",
    "606025": "视频终端",
    "606026": "音视频终端",
    "606027": "音视频通话",
    "606028": "直播",
    "606029": "短视频",
    "606030": "播放器",
    "606031": "虚拟形象",
    "606032": "多人音视频房间",
    "606033": "媒体处理",
    "606034": "媒体处理企业版",
    "606035": "极速高清",
    "606036": "智能识别",
    "606037": "智能审核",
    "606038": "智能编辑",
    "606039": "云渲染",
    "606040": "云游戏",
    "606041": "云桌面",
    "606042": "应用云渲染",
    "606043": "内容创作",
    "606044": "智能创作",
    "606045": "VR 实景漫游",
    "606046": "动效素材",
    "607001": "风控平台",
    "607002": "验证码",
    "607003": "内容安全",
    "607004": "私域安全",
    "607005": "应用合规平台",
    "607006": "账号风控平台",
    "607007": "多因子身份认证",
    "607008": "流量反欺诈",
    "607009": "设备安全",
    "607010": "游戏安全",
    "607011": "服务性能测试",
    "607012": "流量风险决策平台",
    "607013": "测试服务",
    "607014": "标准兼容测试",
    "607015": "远程调试",
    "607016": "网络入侵防护系统",
    "607017": "高级威胁检测追溯",
    "607018": "网络云监测",
    "607019": "安全运营中心",
    "607020": "云防火墙",
    "607021": "云安全中心",
    "607022": "Web 应用防火墙",
    "607023": "API 安全治理",
    "607024": "漏洞扫描服务",
    "607025": "主机安全",
    "607026": "容器安全服务",
    "607027": "微隔离服务",
    "607028": "DDoS 防护",
    "607029": "边缘安全平台",
    "607030": "安全托管服务",
    "607031": "应急响应服务",
    "607032": "渗透测试服务",
    "607033": "安全攻防对抗服务",
    "607034": "零信任安全管理系统",
    "607035": "应用安全访问服务",
    "607036": "数字身份管控平台",
    "607037": "数据安全中心",
    "607038": "云访问安全代理",
    "607039": "数据安全审计",
    "607040": "堡垒机",
    "607041": "密钥管理系统",
    "607042": "SSL 证书",
    "607043": "证书监控",
    "608001": "数据分析",
    "608002": "日志服务",
    "608003": "弹性 MapReduce",
    "608004": "Elasticsearch服务",
    "608005": "云数据仓库",
    "608006": "流计算",
    "608007": "数据湖分析",
    "608008": "数据湖计算",
    "608009": "数据编排平台",
    "608010": "数据集成",
    "608011": "数据应用与可视化",
    "608015": "移动推送",
    "608016": "商业智能分析",
    "608017": "实时计算",
    "608018": "数据总线",
    "608019": "大数据处理套件",
    "608020": "开源大数据平台",
    "609001": "人脸识别",
    "609002": "人体分析",
    "609003": "文字识别",
    "609004": "图像标签",
    "609005": "图像搜索",
    "609006": "图像识别",
    "609007": "媒体智能标签",
    "609008": "图像处理",
    "609009": "人脸融合",
    "609010": "人像变换",
    "609011": "人脸试妆",
    "609012": "AI 绘画",
    "609013": "人像分割",
    "609014": "语音识别",
    "609015": "语音合成",
    "609016": "声音工坊",
    "609017": "NLP 服务",
    "609018": "机器翻译",
    "609019": "人脸核身",
    "609020": "智能保险助手",
    "609021": "智能对话机器人",
    "609022": "智能推荐",
    "609023": "同传系统",
    "609024": "Gpt",
    "610001": "云资源管理",
    "610002": "资源编排",
    "610003": "云监控",
    "610004": "地域管理",
    "610005": "多云管理",
    "610006": "云资源自动化",
    "610007": "访问管理",
    "610008": "账号安全服务",
    "610009": "运维事件管理",
    "610010": "账号威胁发现",
    "610011": "配置审计",
    "610012": "开发者工具",
    "610013": "应用交付",
    "610014": "代码管理",
    "610015": "项目管理",
    "610016": "测试管理",
    "610017": "持续集成",
    "610018": "持续部署",
    "610019": "效能洞察",
    "610020": "代码分析",
    "610021": "低代码",
    "610022": "云迁移",
    "610023": "静态网站托管",
    "610024": "Web 应用托管",
    "610025": "命令行工具",
}
